<Window x:Class="MilkTeaShop.Presentation.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:converters="clr-namespace:MilkTeaShop.Presentation.Converters"
        Title="Quản lý Menu" Height="600" Width="900"
        WindowStartupLocation="CenterOwner">
    
    <Window.Resources>
        <converters:TabVisibilityConverter x:Key="TabVisibilityConverter"/>
        <converters:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
    </Window.Resources>
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <StackPanel Grid.Row="0" Background="DarkBlue" Margin="0,0,0,10">
            <TextBlock Text="QUẢN LÝ MENU" Foreground="White" FontSize="18" 
                       FontWeight="Bold" HorizontalAlignment="Center" Margin="10"/>
        </StackPanel>
        
        <!-- Add Button and Tab Control -->
        <Grid Grid.Row="1" Margin="10,0,10,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>
            
            <Button Grid.Column="0" Content="➕ Thêm món" Command="{Binding AddNewItemCommand}" 
                    Background="Green" Foreground="White" Padding="15,8" FontWeight="Bold"
                    Margin="0,0,20,0"/>
            
            <TabControl Grid.Column="1" SelectedIndex="{Binding SelectedTabIndex}" Height="40">
                <TabItem Header="TRÀ SỮA" FontSize="14" FontWeight="Bold"/>
                <TabItem Header="TOPPING" FontSize="14" FontWeight="Bold"/>
            </TabControl>
        </Grid>
        
        <!-- Menu Lists -->
        <Grid Grid.Row="2" Margin="10,0">
            <!-- Milk Tea List -->
            <ScrollViewer Visibility="{Binding SelectedTabIndex, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=0}">
                <ListView ItemsSource="{Binding MilkTeaItems}" SelectedItem="{Binding SelectedItem}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Ảnh" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Width="60" Height="60" CornerRadius="5" Background="LightGray">
                                            <Grid>
                                                <Image Source="{Binding ImagePath}" Stretch="UniformToFill" 
                                                       Visibility="{Binding ImagePath, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                <TextBlock Text="No Image" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                           FontSize="8" Foreground="Gray"
                                                           Visibility="{Binding ImagePath, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Reverse}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Tên món" DisplayMemberBinding="{Binding Name}" Width="200"/>
                            <GridViewColumn Header="Giá (Medium)" DisplayMemberBinding="{Binding BasePrice, StringFormat='{}{0:N0}đ'}" Width="120"/>
                            <GridViewColumn Header="Mô tả" DisplayMemberBinding="{Binding Description}" Width="250"/>
                            <GridViewColumn Header="Thao tác" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="✏️ Sửa" Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" Background="Orange" Foreground="White" 
                                                    Margin="0,0,5,0" Padding="8,4" FontSize="10"/>
                                            <Button Content="🗑️ Xóa" Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" Background="Red" Foreground="White" 
                                                    Padding="8,4" FontSize="10"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </ScrollViewer>
            
            <!-- Topping List -->
            <ScrollViewer Visibility="{Binding SelectedTabIndex, Converter={StaticResource TabVisibilityConverter}, ConverterParameter=1}">
                <ListView ItemsSource="{Binding ToppingItems}" SelectedItem="{Binding SelectedItem}">
                    <ListView.View>
                        <GridView>
                            <GridViewColumn Header="Ảnh" Width="80">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Width="60" Height="60" CornerRadius="5" Background="LightGray">
                                            <Grid>
                                                <Image Source="{Binding ImagePath}" Stretch="UniformToFill" 
                                                       Visibility="{Binding ImagePath, Converter={StaticResource NullToVisibilityConverter}}"/>
                                                <TextBlock Text="No Image" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                           FontSize="8" Foreground="Gray"
                                                           Visibility="{Binding ImagePath, Converter={StaticResource NullToVisibilityConverter}, ConverterParameter=Reverse}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                            <GridViewColumn Header="Tên topping" DisplayMemberBinding="{Binding Name}" Width="180"/>
                            <GridViewColumn Header="Giá" DisplayMemberBinding="{Binding BasePrice, StringFormat='{}{0:N0}đ'}" Width="100"/>
                            <GridViewColumn Header="Mô tả" DisplayMemberBinding="{Binding Description}" Width="270"/>
                            <GridViewColumn Header="Thao tác" Width="150">
                                <GridViewColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Button Content="✏️ Sửa" Command="{Binding DataContext.EditItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" Background="Orange" Foreground="White" 
                                                    Margin="0,0,5,0" Padding="8,4" FontSize="10"/>
                                            <Button Content="🗑️ Xóa" Command="{Binding DataContext.DeleteItemCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                    CommandParameter="{Binding}" Background="Red" Foreground="White" 
                                                    Padding="8,4" FontSize="10"/>
                                        </StackPanel>
                                    </DataTemplate>
                                </GridViewColumn.CellTemplate>
                            </GridViewColumn>
                        </GridView>
                    </ListView.View>
                </ListView>
            </ScrollViewer>
        </Grid>
        
        <!-- Footer Buttons -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right" Margin="10">
            <Button Content="Làm mới" Command="{Binding RefreshCommand}" 
                    Background="Blue" Foreground="White" Padding="15,8" Margin="0,0,10,0"/>
            <Button Content="Đóng" Click="Close_Click" 
                    Background="Gray" Foreground="White" Padding="15,8"/>
        </StackPanel>
    </Grid>
</Window>